
<div id="sidebar" class="col-2"><%= render'layouts/sidebar', user: @question.user %></div>
<div id="main" class="col-10">

<div class='px-4 py-4'>
  <% if @question.is_solution == true %>
    解決
  <% else %>
    未解決
  <% end %>
  <span class="pl-3"><i class="fa-regular fa-lightbulb"></i> <%= @question.question_answers.count %></span>

  <%#= link_to "#{@question.question_answers.count} 回答数", question_path(@question.id) %>
</div>


<h2><%= @question.title %></h2>

<!-- user icon start -->
<div class="d-flex align-items-center  justify-content-between">
  <div class="d-flex align-items-center">
    <p class="pr-2"><%= image_tag @question.user.get_profile_image, style: "width: 40px" %></p>
    <p><%= @question.user.name %></p>
  </div>
    <p><%= @question.created_at.strftime('%Y/%m/%d') %></p>
</div>
<!-- user icon end -->

<p><%= @question.body %></p>


<div class="d-flex mr-2">
  <p><i class="fa-regular fa-lightbulb"></i> <%= @question.question_answers.count %></p>

  <% if @question.user == current_user %>
    <%= link_to edit_question_path(@question.id), data: {"turbolinks" => false} do %>
      <!--<i class="fa-regular fa-pen-to-square"></i>-->
      <div class="pl-2">
        <i class="fa-solid fa-pencil text-secondary"></i>
      </div>
      <% end %>
    <%= link_to question_path(@question.id), method: :delete, "data-confirm" => "本当に削除しますか？" do %>
      <div class="pl-2">
        <i class="fa-regular fa-trash-can text-secondary"></i>
      </div>
    <% end %>
  <% end %>
</div>


<!-- comment start -->
<div>
  <% @question.question_comments.each do |question_comment| %>
    <div class="d-flex">
      <p><%= image_tag question_comment.user.get_profile_image, style: "width: 50px" %></p>
      <%= question_comment.user.name %>
      <%= question_comment.created_at.strftime('%Y/%m/%d') %><%= question_comment.comment %>
      <% if question_comment.user == current_user %>
        <%= link_to "削除", question_question_comment_path(question_comment.question, question_comment), method: :delete %>
      <% end %>
    </div>
  <% end %>
  <% if user_signed_in? %>
    <div>
      <%= form_with model: [@question, @question_comment] do |f| %>
        <div class="d-flex">
          <%= f.text_area :comment, size: "150x1", placeholder: "コメント入力", class: "display-block" %>
          <%= f.submit "送信する", class: "align-self-end ml-3" %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
<!-- comment end -->

<strong>回答</strong>
<div>
  <% @question.question_answers.each do |question_answer| %>
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div class="d-flex">
          <p><%= image_tag question_answer.user.get_profile_image, style: "width: 50px" %></p>
          <%= question_answer.user.name %>
          <%= question_answer.created_at.strftime('%Y/%m/%d') %>
          </div>
    
          <div class="d-flex">
          <div id="favorites-btn-<%= question_answer.id %>" class="mr-2">
            <%= render "answer_favorites/favorites_btn", answer: question_answer %>
          </div>
          
          <% if question_answer.user == current_user %>
            <%= link_to question_question_answer_path(question_answer.question, question_answer), method: :delete do %>
              <div class="pl-2">
                <i class="fa-regular fa-trash-can text-secondary"></i>
              </div>
            <% end %>
          <% end %>
          </div>
        </div>
        
        <%= safe_join(question_answer.answer.split("\n"),tag(:br)) %>
      </div>
    </div>
  <% end %>
  <% if user_signed_in? %>
    <div>
      <%= form_with model: [@question, @question_answer] do |f| %>
        <div class="d-flex">
          <%= f.text_area :answer, size: "150x3", placeholder: "回答入力", class: "display-block" %>
          <%= f.submit "送信する", class: "align-self-end ml-3" %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
